
<!doctype html>
<html lang="zh-Hant" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../logging/">
      
      
        <link rel="next" href="../response/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.49">
    
    
      
        <title>Request - Unfazed</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.6f8fc17f.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#unfazed-httprequest" class="md-skip">
          跳轉至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="頁首">
    <a href="../.." title="Unfazed" class="md-header__button md-logo" aria-label="Unfazed" data-md-component="logo">
      
  <img src="../../images/uz-logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Unfazed
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Request
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="選擇語言">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="./" hreflang="zh-Hant" class="md-select__link">
              中文
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="../../en/features/request/" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/unfazed-eco/unfazed" title="前往倉庫" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    unfazed
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="導航" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Unfazed" class="md-nav__button md-logo" aria-label="Unfazed" data-md-component="logo">
      
  <img src="../../images/uz-logo.png" alt="logo">

    </a>
    Unfazed
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/unfazed-eco/unfazed" title="前往倉庫" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    unfazed
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tutorial
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Tutorial
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/part1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part 1 Install & Create Project
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/part2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part 2 Create Application
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/part3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part 3 Models and Serializer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/part4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part 4 Endpoint and Schema
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/part5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part 5 Services
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/part6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part 6 Test
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Features
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Features
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../settings/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Settings
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../app/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    App
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../route/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Route
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../middleware/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Middleware
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lifespan/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lifespan
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../logging/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Logging
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Request
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Request
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目錄">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目錄
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      类概述
    </span>
  </a>
  
    <nav class="md-nav" aria-label="类概述">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      核心特性
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      类签名
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      基本用法
    </span>
  </a>
  
    <nav class="md-nav" aria-label="基本用法">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      简单示例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      请求属性详解
    </span>
  </a>
  
    <nav class="md-nav" aria-label="请求属性详解">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#http-method" class="md-nav__link">
    <span class="md-ellipsis">
      HTTP 方法 (Method)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#url" class="md-nav__link">
    <span class="md-ellipsis">
      URL 信息
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      应用实例访问
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      客户端信息
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      应用状态访问
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      请求数据访问
    </span>
  </a>
  
    <nav class="md-nav" aria-label="请求数据访问">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#headers" class="md-nav__link">
    <span class="md-ellipsis">
      请求头 (Headers)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#query-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      查询参数 (Query Parameters)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#path-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      路径参数 (Path Parameters)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cookies" class="md-nav__link">
    <span class="md-ellipsis">
      Cookies
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#request-body" class="md-nav__link">
    <span class="md-ellipsis">
      请求体 (Request Body)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="请求体 (Request Body)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#json" class="md-nav__link">
    <span class="md-ellipsis">
      JSON 数据
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      表单数据
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      文件上传
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      会话和认证
    </span>
  </a>
  
    <nav class="md-nav" aria-label="会话和认证">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      会话管理
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      用户认证
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      实用工具方法
    </span>
  </a>
  
    <nav class="md-nav" aria-label="实用工具方法">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      内容类型检测
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      请求验证
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../response/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Response
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../endpoint/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Endpoint
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../staticfiles.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Staticfiles
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tortoise-orm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ORM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../serializer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Serializer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cache/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cache
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../error/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Error
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../openapi/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OPENAPI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../command/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Command
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../testclient/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Test Client
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Contrib
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Contrib
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contrib/admin/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Admin
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contrib/auth/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Auth
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contrib/session/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Session
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../release-note/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ReleaseNote
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目錄">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目錄
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      类概述
    </span>
  </a>
  
    <nav class="md-nav" aria-label="类概述">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      核心特性
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      类签名
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      基本用法
    </span>
  </a>
  
    <nav class="md-nav" aria-label="基本用法">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      简单示例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      请求属性详解
    </span>
  </a>
  
    <nav class="md-nav" aria-label="请求属性详解">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#http-method" class="md-nav__link">
    <span class="md-ellipsis">
      HTTP 方法 (Method)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#url" class="md-nav__link">
    <span class="md-ellipsis">
      URL 信息
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      应用实例访问
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      客户端信息
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      应用状态访问
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      请求数据访问
    </span>
  </a>
  
    <nav class="md-nav" aria-label="请求数据访问">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#headers" class="md-nav__link">
    <span class="md-ellipsis">
      请求头 (Headers)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#query-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      查询参数 (Query Parameters)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#path-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      路径参数 (Path Parameters)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cookies" class="md-nav__link">
    <span class="md-ellipsis">
      Cookies
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#request-body" class="md-nav__link">
    <span class="md-ellipsis">
      请求体 (Request Body)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="请求体 (Request Body)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#json" class="md-nav__link">
    <span class="md-ellipsis">
      JSON 数据
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      表单数据
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      文件上传
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      会话和认证
    </span>
  </a>
  
    <nav class="md-nav" aria-label="会话和认证">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      会话管理
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      用户认证
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      实用工具方法
    </span>
  </a>
  
    <nav class="md-nav" aria-label="实用工具方法">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      内容类型检测
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      请求验证
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="unfazed-httprequest">Unfazed HttpRequest</h1>
<p>Unfazed 的 <code>HttpRequest</code> 类继承自 Starlette 的 Request 类，在原有功能基础上增强了 JSON 解析、会话管理、用户认证等功能。它是视图函数的第一个参数，包含了 HTTP 请求的所有信息。</p>
<h2 id="_1">类概述</h2>
<h3 id="_2">核心特性</h3>
<ul>
<li><strong>增强的 JSON 解析</strong>: 使用 orjson 提供高性能的 JSON 解析</li>
<li><strong>会话管理集成</strong>: 自动集成会话系统，支持多种会话后端</li>
<li><strong>用户认证支持</strong>: 内置用户认证系统集成</li>
<li><strong>应用实例访问</strong>: 提供对 Unfazed 应用实例的直接访问</li>
<li><strong>缓存优化</strong>: JSON 解析结果缓存，避免重复解析</li>
</ul>
<h3 id="_3">类签名</h3>
<pre><code class="language-python">class HttpRequest(Request):
    def __init__(self, scope: Scope, receive: Receive = None) -&gt; None:
        ...
</code></pre>
<h2 id="_4">基本用法</h2>
<h3 id="_5">简单示例</h3>
<pre><code class="language-python"># endpoints.py
import typing as t
from unfazed.http import HttpRequest, HttpResponse, JsonResponse

async def hello_world(request: HttpRequest) -&gt; HttpResponse:
    &quot;&quot;&quot;简单的 Hello World 端点&quot;&quot;&quot;
    return HttpResponse(&quot;Hello, World!&quot;)

async def echo_request_info(request: HttpRequest) -&gt; JsonResponse:
    &quot;&quot;&quot;回显请求信息&quot;&quot;&quot;
    return JsonResponse({
        &quot;method&quot;: request.method,
        &quot;path&quot;: request.path,
        &quot;scheme&quot;: request.scheme,
        &quot;client_host&quot;: request.client.host if request.client else None,
        &quot;user_agent&quot;: request.headers.get(&quot;user-agent&quot;)
    })
</code></pre>
<h2 id="_6">请求属性详解</h2>
<h3 id="http-method">HTTP 方法 (Method)</h3>
<p>获取 HTTP 请求方法：</p>
<pre><code class="language-python">async def handle_method(request: HttpRequest) -&gt; JsonResponse:
    method = request.method  # GET, POST, PUT, DELETE, etc.

    if method == &quot;GET&quot;:
        return JsonResponse({&quot;action&quot;: &quot;读取数据&quot;})
    elif method == &quot;POST&quot;:
        return JsonResponse({&quot;action&quot;: &quot;创建数据&quot;})
    elif method == &quot;PUT&quot;:
        return JsonResponse({&quot;action&quot;: &quot;更新数据&quot;})
    elif method == &quot;DELETE&quot;:
        return JsonResponse({&quot;action&quot;: &quot;删除数据&quot;})
    else:
        return JsonResponse({&quot;error&quot;: &quot;不支持的方法&quot;}, status_code=405)
</code></pre>
<h3 id="url">URL 信息</h3>
<p><code>HttpRequest</code> 提供了便捷的 URL 属性访问：</p>
<pre><code class="language-python">async def analyze_url(request: HttpRequest) -&gt; JsonResponse:
    &quot;&quot;&quot;分析请求URL的各个组成部分&quot;&quot;&quot;
    url_info = {
        # 便捷属性
        &quot;scheme&quot;: request.scheme,        # http 或 https
        &quot;path&quot;: request.path,           # URL 路径

        # 详细URL信息
        &quot;full_url&quot;: str(request.url),
        &quot;netloc&quot;: request.url.netloc,   # 域名和端口
        &quot;hostname&quot;: request.url.hostname,
        &quot;port&quot;: request.url.port,
        &quot;query&quot;: request.url.query,     # 查询字符串
        &quot;fragment&quot;: request.url.fragment,
        &quot;is_secure&quot;: request.url.is_secure,  # 是否 HTTPS

        # 用户认证信息（如果URL中包含）
        &quot;username&quot;: request.url.username,
        &quot;password&quot;: request.url.password,
    }

    return JsonResponse(url_info)

# 示例请求：https://user:pass@api.example.com:8080/users?page=1#top
# 返回结果：
# {
#     &quot;scheme&quot;: &quot;https&quot;,
#     &quot;path&quot;: &quot;/users&quot;,
#     &quot;netloc&quot;: &quot;api.example.com:8080&quot;,
#     &quot;hostname&quot;: &quot;api.example.com&quot;,
#     &quot;port&quot;: 8080,
#     &quot;query&quot;: &quot;page=1&quot;,
#     &quot;fragment&quot;: &quot;top&quot;,
#     &quot;is_secure&quot;: true,
#     &quot;username&quot;: &quot;user&quot;,
#     &quot;password&quot;: &quot;pass&quot;
# }
</code></pre>
<h3 id="_7">应用实例访问</h3>
<p>访问 Unfazed 应用实例和相关配置：</p>
<pre><code class="language-python">async def get_app_info(request: HttpRequest) -&gt; JsonResponse:
    &quot;&quot;&quot;获取应用信息&quot;&quot;&quot;
    # 两种方式访问应用实例
    app = request.unfazed  # 推荐方式
    app_alt = request.app  # 兼容方式

    return JsonResponse({
        &quot;project_name&quot;: app.settings.PROJECT_NAME,
        &quot;debug_mode&quot;: app.settings.DEBUG,
        &quot;installed_apps&quot;: app.settings.INSTALLED_APPS or [],
        &quot;middleware_count&quot;: len(app.user_middleware),
    })
</code></pre>
<h3 id="_8">客户端信息</h3>
<p>获取客户端连接信息：</p>
<pre><code class="language-python">async def client_info(request: HttpRequest) -&gt; JsonResponse:
    &quot;&quot;&quot;获取客户端信息&quot;&quot;&quot;
    if request.client:
        return JsonResponse({
            &quot;client_host&quot;: request.client.host,
            &quot;client_port&quot;: request.client.port,
            &quot;connection_info&quot;: f&quot;{request.client.host}:{request.client.port}&quot;
        })
    else:
        return JsonResponse({&quot;error&quot;: &quot;无法获取客户端信息&quot;})

async def get_real_ip(request: HttpRequest) -&gt; JsonResponse:
    &quot;&quot;&quot;获取客户端真实IP（考虑代理）&quot;&quot;&quot;
    # 优先从代理头获取真实IP
    real_ip = (
        request.headers.get(&quot;x-forwarded-for&quot;, &quot;&quot;).split(&quot;,&quot;)[0].strip() or
        request.headers.get(&quot;x-real-ip&quot;) or
        (request.client.host if request.client else &quot;unknown&quot;)
    )

    return JsonResponse({&quot;real_ip&quot;: real_ip})
</code></pre>
<h3 id="_9">应用状态访问</h3>
<p>通过生命周期管理系统共享的状态：</p>
<pre><code class="language-python">async def access_shared_state(request: HttpRequest) -&gt; JsonResponse:
    &quot;&quot;&quot;访问生命周期共享状态&quot;&quot;&quot;
    try:
        # 访问由生命周期组件设置的状态
        db_connection = request.state.db_connection
        cache_client = request.state.redis

        return JsonResponse({
            &quot;database_available&quot;: db_connection is not None,
            &quot;cache_available&quot;: cache_client is not None,
            &quot;shared_config&quot;: getattr(request.state, &quot;config&quot;, {})
        })
    except AttributeError as e:
        return JsonResponse({&quot;error&quot;: f&quot;状态未找到: {str(e)}&quot;})
</code></pre>
<blockquote>
<p>参考 <a href="../lifespan/">lifespan 文档</a> 了解更多状态管理信息。</p>
</blockquote>
<h2 id="_10">请求数据访问</h2>
<h3 id="headers">请求头 (Headers)</h3>
<p>虽然推荐使用参数化方式处理请求头，但也可以直接访问：</p>
<pre><code class="language-python"># 推荐的参数化方式
from pydantic import BaseModel, Field
from unfazed.route import params as p

class AuthHeaders(BaseModel):
    authorization: str = Field(..., description=&quot;认证令牌&quot;)
    user_agent: str = Field(default=&quot;unknown&quot;, alias=&quot;user-agent&quot;)
    content_type: str = Field(default=&quot;application/json&quot;, alias=&quot;content-type&quot;)

async def with_headers(
    request: HttpRequest,
    headers: t.Annotated[AuthHeaders, p.Header()]
) -&gt; JsonResponse:
    return JsonResponse({
        &quot;auth_token&quot;: headers.authorization,
        &quot;user_agent&quot;: headers.user_agent,
        &quot;content_type&quot;: headers.content_type
    })

# 直接访问方式
async def direct_headers(request: HttpRequest) -&gt; JsonResponse:
    &quot;&quot;&quot;直接访问请求头&quot;&quot;&quot;
    return JsonResponse({
        &quot;authorization&quot;: request.headers.get(&quot;authorization&quot;),
        &quot;user_agent&quot;: request.headers.get(&quot;user-agent&quot;, &quot;unknown&quot;),
        &quot;content_length&quot;: request.headers.get(&quot;content-length&quot;, &quot;0&quot;),
        &quot;all_headers&quot;: dict(request.headers)
    })
</code></pre>
<blockquote>
<p>参考 <a href="../endpoint/">endpoint 文档</a> 了解参数化处理方式。</p>
</blockquote>
<h3 id="query-parameters">查询参数 (Query Parameters)</h3>
<p>处理 URL 查询字符串参数：</p>
<pre><code class="language-python"># 推荐的参数化方式
class SearchQuery(BaseModel):
    keyword: str = Field(..., description=&quot;搜索关键词&quot;)
    page: int = Field(default=1, ge=1, description=&quot;页码&quot;)
    size: int = Field(default=10, ge=1, le=100, description=&quot;每页数量&quot;)
    sort: str = Field(default=&quot;created_at&quot;, description=&quot;排序字段&quot;)

async def search_with_params(
    request: HttpRequest,
    query: t.Annotated[SearchQuery, p.Query()]
) -&gt; JsonResponse:
    return JsonResponse({
        &quot;keyword&quot;: query.keyword,
        &quot;page&quot;: query.page,
        &quot;size&quot;: query.size,
        &quot;sort&quot;: query.sort,
        &quot;offset&quot;: (query.page - 1) * query.size
    })

# 直接访问方式
async def direct_query(request: HttpRequest) -&gt; JsonResponse:
    &quot;&quot;&quot;直接访问查询参数&quot;&quot;&quot;
    return JsonResponse({
        &quot;keyword&quot;: request.query_params.get(&quot;keyword&quot;),
        &quot;page&quot;: int(request.query_params.get(&quot;page&quot;, &quot;1&quot;)),
        &quot;size&quot;: int(request.query_params.get(&quot;size&quot;, &quot;10&quot;)),
        &quot;all_params&quot;: dict(request.query_params)
    })
</code></pre>
<h3 id="path-parameters">路径参数 (Path Parameters)</h3>
<p>处理 URL 路径中的动态参数：</p>
<pre><code class="language-python"># 推荐的参数化方式
class UserPathParams(BaseModel):
    user_id: int = Field(..., description=&quot;用户ID&quot;)
    action: str = Field(..., description=&quot;操作类型&quot;)

async def user_action(
    request: HttpRequest,
    path_params: t.Annotated[UserPathParams, p.Path()]
) -&gt; JsonResponse:
    return JsonResponse({
        &quot;user_id&quot;: path_params.user_id,
        &quot;action&quot;: path_params.action,
        &quot;message&quot;: f&quot;对用户 {path_params.user_id} 执行 {path_params.action} 操作&quot;
    })

# 直接访问方式
async def direct_path(request: HttpRequest) -&gt; JsonResponse:
    &quot;&quot;&quot;直接访问路径参数&quot;&quot;&quot;
    return JsonResponse({
        &quot;user_id&quot;: request.path_params.get(&quot;user_id&quot;),
        &quot;action&quot;: request.path_params.get(&quot;action&quot;),
        &quot;all_path_params&quot;: dict(request.path_params)
    })
</code></pre>
<h3 id="cookies">Cookies</h3>
<p>处理 HTTP Cookies：</p>
<pre><code class="language-python"># 推荐的参数化方式
class UserCookies(BaseModel):
    session_id: str = Field(..., description=&quot;会话ID&quot;)
    theme: str = Field(default=&quot;light&quot;, description=&quot;主题设置&quot;)
    language: str = Field(default=&quot;zh-CN&quot;, description=&quot;语言设置&quot;)

async def with_cookies(
    request: HttpRequest,
    cookies: t.Annotated[UserCookies, p.Cookie()]
) -&gt; JsonResponse:
    return JsonResponse({
        &quot;session_id&quot;: cookies.session_id,
        &quot;theme&quot;: cookies.theme,
        &quot;language&quot;: cookies.language
    })

# 直接访问方式
async def direct_cookies(request: HttpRequest) -&gt; JsonResponse:
    &quot;&quot;&quot;直接访问 Cookies&quot;&quot;&quot;
    return JsonResponse({
        &quot;session_id&quot;: request.cookies.get(&quot;session_id&quot;),
        &quot;theme&quot;: request.cookies.get(&quot;theme&quot;, &quot;light&quot;),
        &quot;all_cookies&quot;: dict(request.cookies)
    })
</code></pre>
<h3 id="request-body">请求体 (Request Body)</h3>
<p>处理各种格式的请求体数据：</p>
<h4 id="json">JSON 数据</h4>
<pre><code class="language-python"># 推荐的参数化方式
class UserCreateRequest(BaseModel):
    username: str = Field(..., min_length=3, max_length=50)
    email: str = Field(..., regex=r'^[^@]+@[^@]+\.[^@]+$')
    age: int = Field(..., ge=1, le=150)
    profile: dict = Field(default_factory=dict)

async def create_user(
    request: HttpRequest,
    user_data: t.Annotated[UserCreateRequest, p.Json()]
) -&gt; JsonResponse:
    return JsonResponse({
        &quot;message&quot;: &quot;用户创建成功&quot;,
        &quot;user&quot;: user_data.model_dump(),
        &quot;validation_passed&quot;: True
    })

# 直接访问方式
async def direct_json(request: HttpRequest) -&gt; JsonResponse:
    &quot;&quot;&quot;直接解析 JSON 请求体&quot;&quot;&quot;
    try:
        data = await request.json()  # 使用缓存的高性能解析
        return JsonResponse({
            &quot;received_data&quot;: data,
            &quot;data_type&quot;: type(data).__name__
        })
    except Exception as e:
        return JsonResponse({&quot;error&quot;: f&quot;JSON 解析失败: {str(e)}&quot;}, status_code=400)
</code></pre>
<h4 id="_11">表单数据</h4>
<pre><code class="language-python"># 推荐的参数化方式
class ContactForm(BaseModel):
    name: str = Field(..., description=&quot;姓名&quot;)
    email: str = Field(..., description=&quot;邮箱&quot;)
    message: str = Field(..., description=&quot;留言内容&quot;)
    subscribe: bool = Field(default=False, description=&quot;是否订阅&quot;)

async def contact_form(
    request: HttpRequest,
    form_data: t.Annotated[ContactForm, p.Form()]
) -&gt; JsonResponse:
    return JsonResponse({
        &quot;message&quot;: &quot;表单提交成功&quot;,
        &quot;form_data&quot;: form_data.model_dump()
    })

# 直接访问方式
async def direct_form(request: HttpRequest) -&gt; JsonResponse:
    &quot;&quot;&quot;直接处理表单数据&quot;&quot;&quot;
    form_data = await request.form()
    return JsonResponse({
        &quot;name&quot;: form_data.get(&quot;name&quot;),
        &quot;email&quot;: form_data.get(&quot;email&quot;),
        &quot;message&quot;: form_data.get(&quot;message&quot;),
        &quot;all_form_data&quot;: dict(form_data)
    })
</code></pre>
<h3 id="_12">文件上传</h3>
<p>处理文件上传请求：</p>
<pre><code class="language-python">from unfazed.file import UploadFile

# 推荐的参数化方式
async def upload_file(
    request: HttpRequest,
    file: t.Annotated[UploadFile, p.File(description=&quot;上传的文件&quot;)]
) -&gt; JsonResponse:
    &quot;&quot;&quot;处理单文件上传&quot;&quot;&quot;
    return JsonResponse({
        &quot;filename&quot;: file.filename,
        &quot;content_type&quot;: file.content_type,
        &quot;size&quot;: file.size,
        &quot;message&quot;: &quot;文件上传成功&quot;
    })

# 多文件上传
async def upload_multiple_files(
    request: HttpRequest,
    avatar: t.Annotated[UploadFile, p.File(description=&quot;头像文件&quot;)],
    document: t.Annotated[UploadFile, p.File(description=&quot;文档文件&quot;)]
) -&gt; JsonResponse:
    &quot;&quot;&quot;处理多文件上传&quot;&quot;&quot;
    return JsonResponse({
        &quot;avatar&quot;: {
            &quot;filename&quot;: avatar.filename,
            &quot;size&quot;: avatar.size,
            &quot;type&quot;: avatar.content_type
        },
        &quot;document&quot;: {
            &quot;filename&quot;: document.filename,
            &quot;size&quot;: document.size,
            &quot;type&quot;: document.content_type
        }
    })

# 直接访问方式
async def direct_file_upload(request: HttpRequest) -&gt; JsonResponse:
    &quot;&quot;&quot;直接处理文件上传&quot;&quot;&quot;
    form_data = await request.form()

    uploaded_files = []
    for field_name, file_data in form_data.items():
        if hasattr(file_data, 'filename'):  # 是文件对象
            uploaded_files.append({
                &quot;field_name&quot;: field_name,
                &quot;filename&quot;: file_data.filename,
                &quot;content_type&quot;: file_data.content_type,
                &quot;size&quot;: len(await file_data.read())
            })

    return JsonResponse({
        &quot;uploaded_files&quot;: uploaded_files,
        &quot;total_files&quot;: len(uploaded_files)
    })
</code></pre>
<h2 id="_13">会话和认证</h2>
<h3 id="_14">会话管理</h3>
<p>访问和操作用户会话：</p>
<pre><code class="language-python">async def session_demo(request: HttpRequest) -&gt; JsonResponse:
    &quot;&quot;&quot;会话管理示例&quot;&quot;&quot;
    try:
        # 读取会话数据
        user_id = request.session.get(&quot;user_id&quot;)
        username = request.session.get(&quot;username&quot;)

        # 设置会话数据
        request.session[&quot;last_visit&quot;] = &quot;2024-01-01T00:00:00&quot;
        request.session[&quot;page_views&quot;] = request.session.get(&quot;page_views&quot;, 0) + 1

        return JsonResponse({
            &quot;user_id&quot;: user_id,
            &quot;username&quot;: username,
            &quot;page_views&quot;: request.session[&quot;page_views&quot;],
            &quot;session_key&quot;: request.session.session_key
        })
    except ValueError as e:
        return JsonResponse({
            &quot;error&quot;: str(e),
            &quot;hint&quot;: &quot;请确保已安装 SessionMiddleware&quot;
        }, status_code=500)
</code></pre>
<h3 id="_15">用户认证</h3>
<p>访问认证用户信息：</p>
<pre><code class="language-python">async def user_profile(request: HttpRequest) -&gt; JsonResponse:
    &quot;&quot;&quot;获取用户资料&quot;&quot;&quot;
    try:
        user = request.user

        if user:
            return JsonResponse({
                &quot;user_id&quot;: user.id,
                &quot;username&quot;: user.username,
                &quot;email&quot;: user.email,
                &quot;is_authenticated&quot;: True
            })
        else:
            return JsonResponse({
                &quot;is_authenticated&quot;: False,
                &quot;message&quot;: &quot;用户未登录&quot;
            }, status_code=401)

    except ValueError as e:
        return JsonResponse({
            &quot;error&quot;: str(e),
            &quot;hint&quot;: &quot;请确保已安装 AuthenticationMiddleware&quot;
        }, status_code=500)

async def require_auth(request: HttpRequest) -&gt; JsonResponse:
    &quot;&quot;&quot;需要认证的端点&quot;&quot;&quot;
    try:
        if not request.user:
            return JsonResponse({&quot;error&quot;: &quot;需要登录&quot;}, status_code=401)

        return JsonResponse({
            &quot;message&quot;: f&quot;欢迎，{request.user.username}！&quot;,
            &quot;user_permissions&quot;: getattr(request.user, 'permissions', [])
        })
    except ValueError:
        return JsonResponse({&quot;error&quot;: &quot;认证系统未配置&quot;}, status_code=500)
</code></pre>
<h2 id="_16">实用工具方法</h2>
<h3 id="_17">内容类型检测</h3>
<pre><code class="language-python">async def content_type_handler(request: HttpRequest) -&gt; JsonResponse:
    &quot;&quot;&quot;根据内容类型处理请求&quot;&quot;&quot;
    content_type = request.headers.get(&quot;content-type&quot;, &quot;&quot;)

    if &quot;application/json&quot; in content_type:
        data = await request.json()
        return JsonResponse({&quot;type&quot;: &quot;json&quot;, &quot;data&quot;: data})
    elif &quot;application/x-www-form-urlencoded&quot; in content_type:
        data = await request.form()
        return JsonResponse({&quot;type&quot;: &quot;form&quot;, &quot;data&quot;: dict(data)})
    elif &quot;multipart/form-data&quot; in content_type:
        data = await request.form()
        return JsonResponse({&quot;type&quot;: &quot;multipart&quot;, &quot;fields&quot;: list(data.keys())})
    else:
        body = await request.body()
        return JsonResponse({
            &quot;type&quot;: &quot;raw&quot;,
            &quot;content_type&quot;: content_type,
            &quot;body_length&quot;: len(body)
        })
</code></pre>
<h3 id="_18">请求验证</h3>
<pre><code class="language-python">async def validate_request(request: HttpRequest) -&gt; JsonResponse:
    &quot;&quot;&quot;请求验证示例&quot;&quot;&quot;
    errors = []

    # 验证 HTTP 方法
    if request.method not in [&quot;GET&quot;, &quot;POST&quot;, &quot;PUT&quot;, &quot;DELETE&quot;]:
        errors.append(&quot;不支持的 HTTP 方法&quot;)

    # 验证内容类型
    if request.method in [&quot;POST&quot;, &quot;PUT&quot;]:
        content_type = request.headers.get(&quot;content-type&quot;, &quot;&quot;)
        if not content_type:
            errors.append(&quot;缺少 Content-Type 头&quot;)

    # 验证认证头
    auth_header = request.headers.get(&quot;authorization&quot;)
    if not auth_header or not auth_header.startswith(&quot;Bearer &quot;):
        errors.append(&quot;缺少或无效的认证头&quot;)

    if errors:
        return JsonResponse({&quot;errors&quot;: errors}, status_code=400)

    return JsonResponse({&quot;message&quot;: &quot;请求验证通过&quot;})
</code></pre>
<p>通过 Unfazed 的 <code>HttpRequest</code> 类，您可以方便地访问和处理各种类型的 HTTP 请求数据。建议在实际项目中优先使用参数化的方式处理请求数据，这样可以获得更好的类型安全和自动验证功能。</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "\u5df2\u62f7\u8c9d", "clipboard.copy": "\u62f7\u8c9d", "search.result.more.one": "\u6b64\u9801\u5c1a\u6709 1 \u500b\u7b26\u5408\u7684\u9805\u76ee", "search.result.more.other": "\u6b64\u9801\u5c1a\u6709 # \u500b\u7b26\u5408\u7684\u9805\u76ee", "search.result.none": "\u6c92\u6709\u627e\u5230\u7b26\u5408\u689d\u4ef6\u7684\u7d50\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u689d\u4ef6\u7684\u7d50\u679c", "search.result.other": "\u627e\u5230 # \u500b\u7b26\u5408\u689d\u4ef6\u7684\u7d50\u679c", "search.result.placeholder": "\u9375\u5165\u4ee5\u958b\u59cb\u6aa2\u7d22", "search.result.term.missing": "\u7f3a\u5931", "select.version": "\u9078\u64c7\u7248\u672c"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.88dd0f4e.min.js"></script>
      
    
  </body>
</html>