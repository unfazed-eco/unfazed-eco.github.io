
<!doctype html>
<html lang="zh-Hant" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../lifespan/">
      
      
        <link rel="next" href="../request/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.49">
    
    
      
        <title>Logging - Unfazed</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.6f8fc17f.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#unfazed" class="md-skip">
          跳轉至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="頁首">
    <a href="../.." title="Unfazed" class="md-header__button md-logo" aria-label="Unfazed" data-md-component="logo">
      
  <img src="../../images/uz-logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Unfazed
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Logging
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="選擇語言">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="./" hreflang="zh-Hant" class="md-select__link">
              中文
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="../../en/features/logging/" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/unfazed-eco/unfazed" title="前往倉庫" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    unfazed
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="導航" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Unfazed" class="md-nav__button md-logo" aria-label="Unfazed" data-md-component="logo">
      
  <img src="../../images/uz-logo.png" alt="logo">

    </a>
    Unfazed
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/unfazed-eco/unfazed" title="前往倉庫" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    unfazed
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tutorial
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Tutorial
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/part1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part 1 Install & Create Project
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/part2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part 2 Create Application
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/part3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part 3 Models and Serializer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/part4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part 4 Endpoint and Schema
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/part5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part 5 Services
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/part6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part 6 Test
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Features
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Features
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../settings/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Settings
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../app/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    App
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../route/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Route
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../middleware/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Middleware
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lifespan/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lifespan
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Logging
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Logging
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目錄">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目錄
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      系统概述
    </span>
  </a>
  
    <nav class="md-nav" aria-label="系统概述">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      核心组件
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      主要特性
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      多进程安全问题
    </span>
  </a>
  
    <nav class="md-nav" aria-label="多进程安全问题">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      问题背景
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unfazed_1" class="md-nav__link">
    <span class="md-ellipsis">
      Unfazed 解决方案
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      快速开始
    </span>
  </a>
  
    <nav class="md-nav" aria-label="快速开始">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      1. 基础配置
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    <span class="md-ellipsis">
      2. 应用程序中使用
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    <span class="md-ellipsis">
      3. 启动应用
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      进程安全文件处理器详解
    </span>
  </a>
  
    <nav class="md-nav" aria-label="进程安全文件处理器详解">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#unfazedrotatingfilehandler" class="md-nav__link">
    <span class="md-ellipsis">
      UnfazedRotatingFileHandler 特性
    </span>
  </a>
  
    <nav class="md-nav" aria-label="UnfazedRotatingFileHandler 特性">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      文件命名规则
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      日志轮转机制
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      配置系统详解
    </span>
  </a>
  
    <nav class="md-nav" aria-label="配置系统详解">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#logcenter" class="md-nav__link">
    <span class="md-ellipsis">
      LogCenter 配置管理
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      默认配置
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      配置合并策略
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      实际应用场景
    </span>
  </a>
  
    <nav class="md-nav" aria-label="实际应用场景">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      企业级应用配置
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../request/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Request
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../response/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Response
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../endpoint/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Endpoint
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../staticfiles.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Staticfiles
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tortoise-orm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ORM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../serializer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Serializer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cache/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cache
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../error/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Error
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../openapi/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OPENAPI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../command/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Command
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../testclient/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Test Client
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Contrib
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Contrib
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contrib/admin/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Admin
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contrib/auth/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Auth
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contrib/session/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Session
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../release-note/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ReleaseNote
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目錄">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目錄
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      系统概述
    </span>
  </a>
  
    <nav class="md-nav" aria-label="系统概述">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      核心组件
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      主要特性
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      多进程安全问题
    </span>
  </a>
  
    <nav class="md-nav" aria-label="多进程安全问题">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      问题背景
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unfazed_1" class="md-nav__link">
    <span class="md-ellipsis">
      Unfazed 解决方案
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      快速开始
    </span>
  </a>
  
    <nav class="md-nav" aria-label="快速开始">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      1. 基础配置
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    <span class="md-ellipsis">
      2. 应用程序中使用
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    <span class="md-ellipsis">
      3. 启动应用
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      进程安全文件处理器详解
    </span>
  </a>
  
    <nav class="md-nav" aria-label="进程安全文件处理器详解">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#unfazedrotatingfilehandler" class="md-nav__link">
    <span class="md-ellipsis">
      UnfazedRotatingFileHandler 特性
    </span>
  </a>
  
    <nav class="md-nav" aria-label="UnfazedRotatingFileHandler 特性">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      文件命名规则
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      日志轮转机制
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      配置系统详解
    </span>
  </a>
  
    <nav class="md-nav" aria-label="配置系统详解">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#logcenter" class="md-nav__link">
    <span class="md-ellipsis">
      LogCenter 配置管理
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      默认配置
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      配置合并策略
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      实际应用场景
    </span>
  </a>
  
    <nav class="md-nav" aria-label="实际应用场景">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      企业级应用配置
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="unfazed">Unfazed 日志系统</h1>
<p>Unfazed 提供了专为生产环境设计的日志系统，解决了多进程 Web 应用的日志安全问题，并提供了灵活的配置管理机制。</p>
<h2 id="_1">系统概述</h2>
<h3 id="_2">核心组件</h3>
<ul>
<li><strong>LogCenter</strong>: 日志配置管理中心，负责配置合并和初始化</li>
<li><strong>UnfazedRotatingFileHandler</strong>: 进程安全的日志文件处理器，支持日志轮转</li>
<li><strong>默认配置</strong>: 为常见场景提供开箱即用的日志配置</li>
</ul>
<h3 id="_3">主要特性</h3>
<ol>
<li><strong>进程安全</strong>: 每个进程创建独立的日志文件，避免多进程写入冲突</li>
<li><strong>自动轮转</strong>: 基于文件大小的智能日志轮转机制</li>
<li><strong>配置合并</strong>: 自动将用户配置与默认配置合并</li>
<li><strong>灵活格式</strong>: 支持自定义日志格式和多种输出方式</li>
</ol>
<h2 id="_4">多进程安全问题</h2>
<h3 id="_5">问题背景</h3>
<p>在 Python 中，<code>logging</code> 模块是线程安全的，但不是进程安全的。当 Web 应用使用 <code>uvicorn</code>、<code>gunicorn</code> 等多进程部署方式时，多个进程同时写入同一个日志文件会导致：</p>
<ul>
<li><strong>数据竞争</strong>: 文件写入冲突，导致日志内容混乱或丢失</li>
<li><strong>文件锁定</strong>: 进程间争抢文件锁，影响性能</li>
<li><strong>日志损坏</strong>: 并发写入可能导致日志文件格式错误</li>
</ul>
<blockquote>
<p>参考：<a href="https://docs.python.org/3/library/logging.html#thread-safety">Python Logging Thread Safety</a></p>
</blockquote>
<h3 id="unfazed_1">Unfazed 解决方案</h3>
<p>Unfazed 通过为每个进程创建独立的日志文件来解决这个问题：</p>
<pre><code>应用进程 1 → unfazed_hostname_pid12345_ts1630000000.log
应用进程 2 → unfazed_hostname_pid12346_ts1630000000.log
应用进程 3 → unfazed_hostname_pid12347_ts1630000000.log
</code></pre>
<h2 id="_6">快速开始</h2>
<h3 id="1">1. 基础配置</h3>
<pre><code class="language-python"># settings.py
UNFAZED_SETTINGS = {
    &quot;LOGGING&quot;: {
        &quot;version&quot;: 1,
        &quot;disable_existing_loggers&quot;: False,
        &quot;formatters&quot;: {
            &quot;detailed&quot;: {
                &quot;format&quot;: &quot;%(asctime)s [%(levelname)s] %(name)s:%(lineno)d - %(message)s&quot;,
                &quot;datefmt&quot;: &quot;%Y-%m-%d %H:%M:%S&quot;
            },
            &quot;simple&quot;: {
                &quot;format&quot;: &quot;%(asctime)s - %(name)s - %(levelname)s - %(message)s&quot;
            }
        },
        &quot;handlers&quot;: {
            &quot;file&quot;: {
                &quot;class&quot;: &quot;unfazed.logging.handlers.UnfazedRotatingFileHandler&quot;,
                &quot;filename&quot;: &quot;app.log&quot;,
                &quot;maxBytes&quot;: 10485760,  # 10MB
                &quot;formatter&quot;: &quot;detailed&quot;,
                &quot;encoding&quot;: &quot;utf-8&quot;
            },
            &quot;console&quot;: {
                &quot;class&quot;: &quot;logging.StreamHandler&quot;,
                &quot;formatter&quot;: &quot;simple&quot;,
                &quot;level&quot;: &quot;INFO&quot;
            }
        },
        &quot;loggers&quot;: {
            &quot;unfazed&quot;: {
                &quot;handlers&quot;: [&quot;file&quot;, &quot;console&quot;],
                &quot;level&quot;: &quot;DEBUG&quot;,
                &quot;propagate&quot;: False
            },
            &quot;myapp&quot;: {
                &quot;handlers&quot;: [&quot;file&quot;],
                &quot;level&quot;: &quot;INFO&quot;,
                &quot;propagate&quot;: False
            }
        }
    }
}
</code></pre>
<h3 id="2">2. 应用程序中使用</h3>
<pre><code class="language-python">import logging
from unfazed.http import HttpRequest, JsonResponse

# 获取日志记录器
logger = logging.getLogger(&quot;myapp&quot;)

async def user_login(request: HttpRequest) -&gt; JsonResponse:
    &quot;&quot;&quot;用户登录端点&quot;&quot;&quot;

    # 记录请求信息
    logger.info(f&quot;用户登录请求: IP={request.client.host}&quot;)

    # 业务逻辑
    username = request.json.get(&quot;username&quot;)
    password = request.json.get(&quot;password&quot;)

    if not username or not password:
        logger.warning(f&quot;登录参数缺失: username={username}&quot;)
        return JsonResponse({&quot;error&quot;: &quot;用户名和密码不能为空&quot;}, status_code=400)

    # 模拟身份验证
    user = await authenticate_user(username, password)

    if user:
        logger.info(f&quot;用户登录成功: user_id={user.id}, username={username}&quot;)
        return JsonResponse({&quot;message&quot;: &quot;登录成功&quot;, &quot;user_id&quot;: user.id})
    else:
        logger.warning(f&quot;用户登录失败: username={username}, reason=invalid_credentials&quot;)
        return JsonResponse({&quot;error&quot;: &quot;用户名或密码错误&quot;}, status_code=401)

async def authenticate_user(username: str, password: str):
    &quot;&quot;&quot;模拟用户身份验证&quot;&quot;&quot;
    # 实际的身份验证逻辑
    return None
</code></pre>
<h3 id="3">3. 启动应用</h3>
<pre><code class="language-bash"># 单进程启动
uvicorn asgi:application --host 0.0.0.0 --port 9527

# 多进程启动 
uvicorn asgi:application --host 0.0.0.0 --port 9527 --workers 4
</code></pre>
<p><strong>生成的日志文件示例:</strong></p>
<pre><code>app_hostname_pid12345_ts1630000000.log  # 进程 1
app_hostname_pid12346_ts1630000000.log  # 进程 2
app_hostname_pid12347_ts1630000000.log  # 进程 3
app_hostname_pid12348_ts1630000000.log  # 进程 4
</code></pre>
<h2 id="_7">进程安全文件处理器详解</h2>
<h3 id="unfazedrotatingfilehandler">UnfazedRotatingFileHandler 特性</h3>
<pre><code class="language-python">from unfazed.logging.handlers import UnfazedRotatingFileHandler

# 创建处理器
handler = UnfazedRotatingFileHandler(
    filename=&quot;myapp.log&quot;,        # 基础文件名
    maxBytes=10*1024*1024,       # 10MB 后轮转
    encoding=&quot;utf-8&quot;,            # 文件编码
    delay=True                   # 延迟创建文件
)
</code></pre>
<h4 id="_8">文件命名规则</h4>
<p>原始文件名: <code>myapp.log</code>
实际文件名: <code>myapp_{hostname}_pid{process_id}_ts{timestamp}.log</code></p>
<p>例如:</p>
<pre><code>myapp_server01_pid12345_ts1634567890.log
</code></pre>
<h4 id="_9">日志轮转机制</h4>
<p>当日志文件大小超过 <code>maxBytes</code> 时：</p>
<ol>
<li><strong>关闭当前文件</strong>: 停止向当前文件写入</li>
<li><strong>重命名归档</strong>: 将当前文件重命名为 <code>{name}_archived.log</code></li>
<li><strong>创建新文件</strong>: 使用新的进程安全文件名创建文件</li>
<li><strong>继续写入</strong>: 向新文件写入后续日志</li>
</ol>
<pre><code class="language-python"># 轮转前
myapp_server01_pid12345_ts1634567890.log  # 当前文件

# 轮转后  
myapp_server01_pid12345_ts1634567890_archived.log  # 归档文件
myapp_server01_pid12345_ts1634567891.log           # 新文件
</code></pre>
<h2 id="_10">配置系统详解</h2>
<h3 id="logcenter">LogCenter 配置管理</h3>
<pre><code class="language-python">from unfazed.logging import LogCenter
from unfazed.core import Unfazed

# 创建 Unfazed 应用
unfazed = Unfazed()

# 自定义日志配置
custom_config = {
    &quot;version&quot;: 1,
    &quot;formatters&quot;: {
        &quot;json&quot;: {
            &quot;format&quot;: '{&quot;timestamp&quot;: &quot;%(asctime)s&quot;, &quot;level&quot;: &quot;%(levelname)s&quot;, &quot;logger&quot;: &quot;%(name)s&quot;, &quot;message&quot;: &quot;%(message)s&quot;}'
        }
    },
    &quot;handlers&quot;: {
        &quot;json_file&quot;: {
            &quot;class&quot;: &quot;unfazed.logging.handlers.UnfazedRotatingFileHandler&quot;,
            &quot;filename&quot;: &quot;app_json.log&quot;,
            &quot;formatter&quot;: &quot;json&quot;,
            &quot;maxBytes&quot;: 5242880  # 5MB
        }
    },
    &quot;loggers&quot;: {
        &quot;api&quot;: {
            &quot;handlers&quot;: [&quot;json_file&quot;],
            &quot;level&quot;: &quot;INFO&quot;
        }
    }
}

# 创建日志中心并设置
log_center = LogCenter(unfazed, custom_config)
log_center.setup()
</code></pre>
<h3 id="_11">默认配置</h3>
<p>Unfazed 提供了开箱即用的默认配置：</p>
<pre><code class="language-python">DEFAULT_LOGGING_CONFIG = {
    &quot;formatters&quot;: {
        &quot;_simple&quot;: {
            &quot;format&quot;: &quot;%(asctime)s - %(name)s - %(levelname)s - %(message)s&quot;,
            &quot;datefmt&quot;: &quot;%Y-%m-%d %H:%M:%S&quot;,
        }
    },
    &quot;handlers&quot;: {
        &quot;_console&quot;: {
            &quot;class&quot;: &quot;logging.StreamHandler&quot;,
            &quot;level&quot;: &quot;DEBUG&quot;,
            &quot;formatter&quot;: &quot;_simple&quot;,
        }
    },
    &quot;loggers&quot;: {
        &quot;unfazed&quot;: {&quot;level&quot;: &quot;DEBUG&quot;, &quot;handlers&quot;: [&quot;_console&quot;]},
        &quot;uvicorn&quot;: {&quot;level&quot;: &quot;INFO&quot;, &quot;handlers&quot;: [&quot;_console&quot;]},
        &quot;tortoise&quot;: {&quot;level&quot;: &quot;INFO&quot;, &quot;handlers&quot;: [&quot;_console&quot;]},
    },
    &quot;version&quot;: 1,
}
</code></pre>
<h3 id="_12">配置合并策略</h3>
<p>用户配置会与默认配置智能合并：</p>
<ol>
<li><strong>格式化器合并</strong>: <code>formatters</code> 部分会合并，用户配置覆盖同名项</li>
<li><strong>处理器合并</strong>: <code>handlers</code> 部分会合并，用户配置覆盖同名项  </li>
<li><strong>记录器合并</strong>: <code>loggers</code> 部分会合并，用户配置覆盖同名项</li>
<li><strong>其他配置</strong>: <code>version</code>、<code>disable_existing_loggers</code> 等直接使用用户配置</li>
</ol>
<h2 id="_13">实际应用场景</h2>
<h3 id="_14">企业级应用配置</h3>
<pre><code class="language-python"># settings.py - 生产环境配置
UNFAZED_SETTINGS = {
    &quot;LOGGING&quot;: {
        &quot;version&quot;: 1,
        &quot;disable_existing_loggers&quot;: False,
        &quot;formatters&quot;: {
            &quot;production&quot;: {
                &quot;format&quot;: &quot;%(asctime)s [%(levelname)s] %(name)s:%(lineno)d [%(process)d:%(thread)d] - %(message)s&quot;,
                &quot;datefmt&quot;: &quot;%Y-%m-%d %H:%M:%S&quot;
            },
            &quot;json&quot;: {
                &quot;format&quot;: '{&quot;timestamp&quot;: &quot;%(asctime)s&quot;, &quot;level&quot;: &quot;%(levelname)s&quot;, &quot;logger&quot;: &quot;%(name)s&quot;, &quot;process&quot;: %(process)d, &quot;thread&quot;: %(thread)d, &quot;message&quot;: &quot;%(message)s&quot;}'
            }
        },
        &quot;handlers&quot;: {
            # 应用日志
            &quot;app_file&quot;: {
                &quot;class&quot;: &quot;unfazed.logging.handlers.UnfazedRotatingFileHandler&quot;,
                &quot;filename&quot;: &quot;app.log&quot;,
                &quot;maxBytes&quot;: 50*1024*1024,  # 50MB
                &quot;formatter&quot;: &quot;production&quot;,
                &quot;encoding&quot;: &quot;utf-8&quot;
            },
            # 错误日志
            &quot;error_file&quot;: {
                &quot;class&quot;: &quot;unfazed.logging.handlers.UnfazedRotatingFileHandler&quot;, 
                &quot;filename&quot;: &quot;error.log&quot;,
                &quot;maxBytes&quot;: 20*1024*1024,  # 20MB
                &quot;formatter&quot;: &quot;production&quot;,
                &quot;level&quot;: &quot;ERROR&quot;,
                &quot;encoding&quot;: &quot;utf-8&quot;
            },
            # 访问日志 (JSON 格式)
            &quot;access_file&quot;: {
                &quot;class&quot;: &quot;unfazed.logging.handlers.UnfazedRotatingFileHandler&quot;,
                &quot;filename&quot;: &quot;access.log&quot;, 
                &quot;maxBytes&quot;: 100*1024*1024,  # 100MB
                &quot;formatter&quot;: &quot;json&quot;,
                &quot;encoding&quot;: &quot;utf-8&quot;
            },
            # 控制台输出
            &quot;console&quot;: {
                &quot;class&quot;: &quot;logging.StreamHandler&quot;,
                &quot;formatter&quot;: &quot;production&quot;,
                &quot;level&quot;: &quot;INFO&quot;
            }
        },
        &quot;loggers&quot;: {
            # 应用主日志
            &quot;myapp&quot;: {
                &quot;handlers&quot;: [&quot;app_file&quot;, &quot;error_file&quot;, &quot;console&quot;],
                &quot;level&quot;: &quot;INFO&quot;,
                &quot;propagate&quot;: False
            },
            # 访问日志
            &quot;myapp.access&quot;: {
                &quot;handlers&quot;: [&quot;access_file&quot;],
                &quot;level&quot;: &quot;INFO&quot;,
                &quot;propagate&quot;: False
            },
            # 数据库日志
            &quot;myapp.database&quot;: {
                &quot;handlers&quot;: [&quot;app_file&quot;],
                &quot;level&quot;: &quot;WARNING&quot;,
                &quot;propagate&quot;: False
            },
            # 外部 API 调用日志
            &quot;myapp.external&quot;: {
                &quot;handlers&quot;: [&quot;app_file&quot;, &quot;error_file&quot;],
                &quot;level&quot;: &quot;INFO&quot;,
                &quot;propagate&quot;: False
            },
            # 框架日志
            &quot;unfazed&quot;: {
                &quot;handlers&quot;: [&quot;app_file&quot;, &quot;console&quot;],
                &quot;level&quot;: &quot;WARNING&quot;,
                &quot;propagate&quot;: False
            }
        }
    }
}
</code></pre>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "\u5df2\u62f7\u8c9d", "clipboard.copy": "\u62f7\u8c9d", "search.result.more.one": "\u6b64\u9801\u5c1a\u6709 1 \u500b\u7b26\u5408\u7684\u9805\u76ee", "search.result.more.other": "\u6b64\u9801\u5c1a\u6709 # \u500b\u7b26\u5408\u7684\u9805\u76ee", "search.result.none": "\u6c92\u6709\u627e\u5230\u7b26\u5408\u689d\u4ef6\u7684\u7d50\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u689d\u4ef6\u7684\u7d50\u679c", "search.result.other": "\u627e\u5230 # \u500b\u7b26\u5408\u689d\u4ef6\u7684\u7d50\u679c", "search.result.placeholder": "\u9375\u5165\u4ee5\u958b\u59cb\u6aa2\u7d22", "search.result.term.missing": "\u7f3a\u5931", "select.version": "\u9078\u64c7\u7248\u672c"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.88dd0f4e.min.js"></script>
      
    
  </body>
</html>