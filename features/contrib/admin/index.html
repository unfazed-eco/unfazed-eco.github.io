
<!doctype html>
<html lang="zh-Hant" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../testclient/">
      
      
        <link rel="next" href="../auth/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.49">
    
    
      
        <title>Admin - Unfazed</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.6f8fc17f.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#unfazed-admin" class="md-skip">
          跳轉至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="頁首">
    <a href="../../.." title="Unfazed" class="md-header__button md-logo" aria-label="Unfazed" data-md-component="logo">
      
  <img src="../../../images/uz-logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Unfazed
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Admin
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="選擇語言">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="./" hreflang="zh-Hant" class="md-select__link">
              中文
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="../../../en/features/contrib/admin/" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/unfazed-eco/unfazed" title="前往倉庫" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    unfazed
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="導航" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Unfazed" class="md-nav__button md-logo" aria-label="Unfazed" data-md-component="logo">
      
  <img src="../../../images/uz-logo.png" alt="logo">

    </a>
    Unfazed
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/unfazed-eco/unfazed" title="前往倉庫" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    unfazed
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tutorial
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Tutorial
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorial/part1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part 1 Install & Create Project
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorial/part2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part 2 Create Application
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorial/part3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part 3 Models and Serializer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorial/part4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part 4 Endpoint and Schema
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorial/part5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part 5 Services
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorial/part6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part 6 Test
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Features
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Features
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../settings/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Settings
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../app/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    App
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../route/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Route
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../middleware/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Middleware
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lifespan/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lifespan
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../logging/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Logging
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../request/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Request
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../response/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Response
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../endpoint/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Endpoint
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../staticfiles.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Staticfiles
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tortoise-orm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ORM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../serializer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Serializer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cache/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cache
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../error/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Error
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../openapi/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OPENAPI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../command/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Command
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../testclient/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Test Client
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Contrib
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Contrib
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Admin
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Admin
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目錄">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目錄
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      系统概述
    </span>
  </a>
  
    <nav class="md-nav" aria-label="系统概述">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      核心特性
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      核心组件
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      快速开始
    </span>
  </a>
  
    <nav class="md-nav" aria-label="快速开始">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      基本配置
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#admin" class="md-nav__link">
    <span class="md-ellipsis">
      注册模型到 Admin
    </span>
  </a>
  
    <nav class="md-nav" aria-label="注册模型到 Admin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#django-admin" class="md-nav__link">
    <span class="md-ellipsis">
      与 Django Admin 的重要区别
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#serializer-model" class="md-nav__link">
    <span class="md-ellipsis">
      为什么使用 Serializer 而不是 Model？
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      完整示例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      配置路由
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      模型管理详解
    </span>
  </a>
  
    <nav class="md-nav" aria-label="模型管理详解">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#modeladmin" class="md-nav__link">
    <span class="md-ellipsis">
      ModelAdmin 配置
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      关系字段管理
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      自定义操作按钮
    </span>
  </a>
  
    <nav class="md-nav" aria-label="自定义操作按钮">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#action" class="md-nav__link">
    <span class="md-ellipsis">
      Action 装饰器
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      权限管理系统
    </span>
  </a>
  
    <nav class="md-nav" aria-label="权限管理系统">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      基础权限控制
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      基于角色的权限控制
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      操作日志系统
    </span>
  </a>
  
    <nav class="md-nav" aria-label="操作日志系统">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#logentry" class="md-nav__link">
    <span class="md-ellipsis">
      LogEntry 模型
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      日志装饰器
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      查看操作日志
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api" class="md-nav__link">
    <span class="md-ellipsis">
      API 接口详解
    </span>
  </a>
  
    <nav class="md-nav" aria-label="API 接口详解">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api_1" class="md-nav__link">
    <span class="md-ellipsis">
      核心 API 端点
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      查询条件格式
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      总结
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../auth/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Auth
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../session/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Session
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../release-note/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ReleaseNote
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目錄">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目錄
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      系统概述
    </span>
  </a>
  
    <nav class="md-nav" aria-label="系统概述">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      核心特性
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      核心组件
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      快速开始
    </span>
  </a>
  
    <nav class="md-nav" aria-label="快速开始">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      基本配置
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#admin" class="md-nav__link">
    <span class="md-ellipsis">
      注册模型到 Admin
    </span>
  </a>
  
    <nav class="md-nav" aria-label="注册模型到 Admin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#django-admin" class="md-nav__link">
    <span class="md-ellipsis">
      与 Django Admin 的重要区别
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#serializer-model" class="md-nav__link">
    <span class="md-ellipsis">
      为什么使用 Serializer 而不是 Model？
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      完整示例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      配置路由
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      模型管理详解
    </span>
  </a>
  
    <nav class="md-nav" aria-label="模型管理详解">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#modeladmin" class="md-nav__link">
    <span class="md-ellipsis">
      ModelAdmin 配置
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      关系字段管理
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      自定义操作按钮
    </span>
  </a>
  
    <nav class="md-nav" aria-label="自定义操作按钮">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#action" class="md-nav__link">
    <span class="md-ellipsis">
      Action 装饰器
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      权限管理系统
    </span>
  </a>
  
    <nav class="md-nav" aria-label="权限管理系统">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      基础权限控制
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      基于角色的权限控制
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      操作日志系统
    </span>
  </a>
  
    <nav class="md-nav" aria-label="操作日志系统">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#logentry" class="md-nav__link">
    <span class="md-ellipsis">
      LogEntry 模型
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      日志装饰器
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      查看操作日志
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api" class="md-nav__link">
    <span class="md-ellipsis">
      API 接口详解
    </span>
  </a>
  
    <nav class="md-nav" aria-label="API 接口详解">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api_1" class="md-nav__link">
    <span class="md-ellipsis">
      核心 API 端点
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      查询条件格式
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      总结
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="unfazed-admin">Unfazed Admin 管理后台</h1>
<p>Unfazed Admin 是一个强大的 Web 管理后台系统，为 Unfazed 应用提供了完整的数据管理、用户权限控制和操作日志记录功能。它基于 Tortoise ORM 和 Unfazed Serializer 构建，提供了类似 Django Admin 的管理界面，但专为异步 Web 应用优化。</p>
<p>Unfazed Admin 模块只提供后端接口，前端需要使用 unfazed-admin 组件来构建管理后台。</p>
<h2 id="_1">系统概述</h2>
<h3 id="_2">核心特性</h3>
<ul>
<li><strong>模型管理</strong>: 自动生成基于 Tortoise ORM 模型的 CRUD 操作界面</li>
<li><strong>权限控制</strong>: 基于用户角色的精细化权限管理系统</li>
<li><strong>关系字段</strong>: 支持外键、一对一、多对多关系的内联编辑</li>
<li><strong>自定义操作</strong>: 支持自定义业务操作和批量操作</li>
<li><strong>操作日志</strong>: 完整的操作记录和审计追踪</li>
<li><strong>可扩展性</strong>: 支持自定义字段、表单和页面组件</li>
</ul>
<h3 id="_3">核心组件</h3>
<ul>
<li><strong>AdminModelService</strong>: 核心服务类，处理所有管理操作</li>
<li><strong>ModelAdmin</strong>: 模型管理器，定义模型的管理行为</li>
<li><strong>CustomAdmin</strong>: 自定义管理器，用于自定义管理界面</li>
<li><strong>AdminCollector</strong>: 管理器注册中心</li>
<li><strong>LogEntry</strong>: 操作日志模型</li>
<li><strong>权限装饰器</strong>: 基于角色的权限控制</li>
</ul>
<h2 id="_4">快速开始</h2>
<h3 id="_5">基本配置</h3>
<pre><code class="language-python"># settings.py
UNFAZED_SETTINGS = {
    &quot;INSTALLED_APPS&quot;: [
        &quot;unfazed.contrib.auth&quot;,
        &quot;unfazed.contrib.admin&quot;,  # 启用 Admin 系统
        &quot;myapp.users&quot;,
        &quot;myapp.products&quot;,
    ],
    # 其他配置...
}
</code></pre>
<h3 id="admin">注册模型到 Admin</h3>
<h4 id="django-admin">与 Django Admin 的重要区别</h4>
<p><strong>Django Admin</strong> 直接注册 Model：</p>
<pre><code class="language-python"># Django 方式
from django.contrib import admin
from .models import User

@admin.register(User)
class UserAdmin(admin.ModelAdmin):
    pass
</code></pre>
<p><strong>Unfazed Admin</strong> 注册 Serializer：</p>
<pre><code class="language-python"># Unfazed 方式
from unfazed.contrib.admin.registry import ModelAdmin, register
from unfazed.serializer import Serializer
from .models import User

class UserSerializer(Serializer):
    class Meta:
        model = User

@register(UserSerializer)  # 注册的是 Serializer，不是 Model
class UserAdmin(ModelAdmin):
    pass
</code></pre>
<h4 id="serializer-model">为什么使用 Serializer 而不是 Model？</h4>
<p><strong>1. 更高的灵活性</strong></p>
<pre><code class="language-python">class ProductSerializer(Serializer):
    # 自定义字段 - Model 中不存在的计算字段
    total_sales = fields.IntField(description=&quot;总销量&quot;)
    profit_margin = fields.FloatField(description=&quot;利润率&quot;)

    class Meta:
        model = Product
        # 精确控制显示的字段
        include = [&quot;id&quot;, &quot;name&quot;, &quot;price&quot;, &quot;category&quot;, &quot;created_at&quot;]
        # 或排除敏感字段
        exclude = [&quot;internal_notes&quot;, &quot;cost_price&quot;]

    async def get_total_sales(self, obj):
        &quot;&quot;&quot;计算总销量&quot;&quot;&quot;
        return await obj.order_items.all().count()

    async def get_profit_margin(self, obj):
        &quot;&quot;&quot;计算利润率&quot;&quot;&quot;
        if obj.cost_price &gt; 0:
            return ((obj.price - obj.cost_price) / obj.cost_price) * 100
        return 0
</code></pre>
<p><strong>2. 数据转换和格式化</strong></p>
<pre><code class="language-python">class UserSerializer(Serializer):
    # 格式化显示
    full_name = fields.CharField(description=&quot;完整姓名&quot;)
    account_age = fields.IntField(description=&quot;账户年龄（天）&quot;)

    class Meta:
        model = User
        include = [&quot;id&quot;, &quot;username&quot;, &quot;email&quot;, &quot;is_active&quot;, &quot;created_at&quot;]

    async def get_full_name(self, obj):
        &quot;&quot;&quot;组合显示完整姓名&quot;&quot;&quot;
        return f&quot;{obj.first_name} {obj.last_name}&quot;.strip()

    async def get_account_age(self, obj):
        &quot;&quot;&quot;计算账户年龄&quot;&quot;&quot;
        from datetime import datetime
        return (datetime.now() - obj.created_at).days
</code></pre>
<p><strong>3. 关系字段的精确控制</strong></p>
<pre><code class="language-python">class OrderSerializer(Serializer):
    # 自定义关系字段显示
    customer_info = fields.DictField(description=&quot;客户信息&quot;)
    items_summary = fields.ListField(description=&quot;订单项摘要&quot;)

    class Meta:
        model = Order
        include = [&quot;id&quot;, &quot;order_number&quot;, &quot;status&quot;, &quot;total_amount&quot;, &quot;created_at&quot;]
        # 启用关系字段
        enable_relations = True

    async def get_customer_info(self, obj):
        &quot;&quot;&quot;自定义客户信息显示&quot;&quot;&quot;
        return {
            &quot;name&quot;: obj.customer.name,
            &quot;email&quot;: obj.customer.email,
            &quot;phone&quot;: obj.customer.phone,
            &quot;vip_level&quot;: obj.customer.vip_level
        }

    async def get_items_summary(self, obj):
        &quot;&quot;&quot;订单项摘要&quot;&quot;&quot;
        items = await obj.items.all().select_related(&quot;product&quot;)
        return [
            {
                &quot;product&quot;: item.product.name,
                &quot;quantity&quot;: item.quantity,
                &quot;price&quot;: item.price
            }
            for item in items
        ]
</code></pre>
<p><strong>4. 业务逻辑封装</strong></p>
<pre><code class="language-python">class ProductSerializer(Serializer):
    class Meta:
        model = Product

    # Serializer 提供的 CRUD 方法
    async def create_from_ctx(self, data):
        &quot;&quot;&quot;自定义创建逻辑&quot;&quot;&quot;
        # 创建前的业务处理
        if data.get('category_id'):
            category = await Category.get(id=data['category_id'])
            if not category.is_active:
                raise ValueError(&quot;无法在非激活分类下创建产品&quot;)

        # 自动生成 SKU
        if not data.get('sku'):
            data['sku'] = await self.generate_sku(data)

        return await super().create_from_ctx(data)

    async def update_from_ctx(self, instance, data):
        &quot;&quot;&quot;自定义更新逻辑&quot;&quot;&quot;
        # 价格变更记录
        if 'price' in data and data['price'] != instance.price:
            await PriceHistory.create(
                product=instance,
                old_price=instance.price,
                new_price=data['price'],
                changed_by=self.context.get('user')
            )

        return await super().update_from_ctx(instance, data)

    async def generate_sku(self, data):
        &quot;&quot;&quot;生成产品 SKU&quot;&quot;&quot;
        category_code = await Category.get(id=data['category_id']).code
        count = await Product.all().count()
        return f&quot;{category_code}{count + 1:06d}&quot;
</code></pre>
<h4 id="_6">完整示例</h4>
<pre><code class="language-python"># myapp/admin.py
from unfazed.contrib.admin.registry import ModelAdmin, register
from unfazed.serializer import Serializer
from .models import User, Product, Category

# 定义 Serializer
class UserSerializer(Serializer):
    class Meta:
        model = User

class ProductSerializer(Serializer):
    class Meta:
        model = Product
        include = [&quot;id&quot;, &quot;name&quot;, &quot;price&quot;, &quot;category&quot;, &quot;created_at&quot;]

class CategorySerializer(Serializer):
    class Meta:
        model = Category

# 注册到 Admin
@register(UserSerializer)
class UserAdmin(ModelAdmin):
    # 基本配置
    route_label = &quot;用户管理&quot;
    help_text = &quot;管理系统用户&quot;

    # 界面配置
    icon = &quot;user&quot;
    component = &quot;UserManagement&quot;

    # 权限控制（可选重写）
    async def has_view_perm(self, request) -&gt; bool:
        return request.user.is_superuser

    async def has_create_perm(self, request) -&gt; bool:
        return request.user.is_superuser

    async def has_change_perm(self, request) -&gt; bool:
        return request.user.is_superuser

    async def has_delete_perm(self, request) -&gt; bool:
        return request.user.is_superuser

@register(ProductSerializer)
class ProductAdmin(ModelAdmin):
    route_label = &quot;产品管理&quot;
    help_text = &quot;管理产品信息&quot;
    icon = &quot;product&quot;

@register(CategorySerializer)
class CategoryAdmin(ModelAdmin):
    route_label = &quot;分类管理&quot;
    help_text = &quot;管理产品分类&quot;
    icon = &quot;category&quot;
</code></pre>
<h3 id="_7">配置路由</h3>
<pre><code class="language-python"># urls.py
from unfazed.route import path, include

urlpatterns = [
    # Admin API 路由
    path(&quot;/api/contrib/admin/&quot;, include(&quot;unfazed.contrib.admin.routes&quot;)),
    # 其他路由...
]
</code></pre>
<h2 id="_8">模型管理详解</h2>
<h3 id="modeladmin">ModelAdmin 配置</h3>
<pre><code class="language-python">from unfazed.contrib.admin.registry import ModelAdmin, register, action
from unfazed.contrib.admin.registry.schema import ActionKwargs
from unfazed.http import HttpResponse
import csv
import io

@register(ProductSerializer)
class ProductAdmin(ModelAdmin):
    # 基础配置
    route_label = &quot;产品管理&quot;
    help_text = &quot;管理所有产品信息&quot;

    # 界面配置
    icon = &quot;shopping-cart&quot;
    component = &quot;ProductManagement&quot;
    hideInMenu = False
    hideChildrenInMenu = False

    # 覆盖现有注册（如果存在同名 Admin）
    override = False

    # 权限控制
    async def has_view_perm(self, request) -&gt; bool:
        &quot;&quot;&quot;查看权限&quot;&quot;&quot;
        return request.user.is_authenticated

    async def has_create_perm(self, request) -&gt; bool:
        &quot;&quot;&quot;创建权限&quot;&quot;&quot;
        return request.user.is_superuser

    async def has_change_perm(self, request) -&gt; bool:
        &quot;&quot;&quot;修改权限&quot;&quot;&quot;
        return request.user.is_superuser

    async def has_delete_perm(self, request) -&gt; bool:
        &quot;&quot;&quot;删除权限&quot;&quot;&quot;
        return request.user.is_superuser

    async def has_action_perm(self, request) -&gt; bool:
        &quot;&quot;&quot;执行操作权限&quot;&quot;&quot;
        return request.user.is_superuser

    # 自定义操作
    @action(name=&quot;导出CSV&quot;, confirm=True)
    async def export_csv(self, ctx: ActionKwargs) -&gt; HttpResponse:
        &quot;&quot;&quot;导出产品数据为 CSV 文件&quot;&quot;&quot;
        # 获取查询条件
        queryset = ProductSerializer.get_queryset(ctx.search_condition)
        products = await ProductSerializer.list_from_ctx(queryset)

        # 生成 CSV
        output = io.StringIO()
        writer = csv.writer(output)
        writer.writerow(['ID', '名称', '价格', '分类', '创建时间'])

        for product in products.data:
            writer.writerow([
                product['id'],
                product['name'],
                product['price'],
                product['category']['name'] if product.get('category') else '',
                product['created_at']
            ])

        # 返回 CSV 响应
        content = output.getvalue().encode('utf-8-sig')
        return HttpResponse(
            content,
            headers={
                'Content-Type': 'text/csv; charset=utf-8',
                'Content-Disposition': 'attachment; filename=&quot;products.csv&quot;'
            }
        )

    @action(name=&quot;批量更新价格&quot;)
    async def bulk_update_price(self, ctx: ActionKwargs) -&gt; dict:
        &quot;&quot;&quot;批量更新产品价格&quot;&quot;&quot;
        factor = ctx.form_data.get('factor', 1.0)

        # 根据搜索条件获取产品
        queryset = ProductSerializer.get_queryset(ctx.search_condition)
        products = await queryset

        updated_count = 0
        for product in products:
            product.price = product.price * factor
            await product.save()
            updated_count += 1

        return {
            &quot;message&quot;: f&quot;成功更新 {updated_count} 个产品的价格&quot;,
            &quot;updated_count&quot;: updated_count
        }
</code></pre>
<h3 id="_9">关系字段管理</h3>
<pre><code class="language-python">from unfazed.contrib.admin.registry import (
    ModelAdmin, ModelInlineAdmin, register,
    AdminRelation, AdminThrough
)

# 模型定义（示例）
class User(Model):
    id = fields.IntField(primary_key=True)
    name = fields.CharField(max_length=100)
    email = fields.CharField(max_length=255)

class Profile(Model):
    id = fields.IntField(primary_key=True)
    user = fields.OneToOneField(&quot;models.User&quot;, related_name=&quot;profile&quot;)
    bio = fields.TextField()

class Role(Model):
    id = fields.IntField(primary_key=True)
    name = fields.CharField(max_length=50)

class UserRole(Model):
    id = fields.IntField(primary_key=True)
    user = fields.ForeignKeyField(&quot;models.User&quot;)
    role = fields.ForeignKeyField(&quot;models.Role&quot;)

class Book(Model):
    id = fields.IntField(primary_key=True)
    title = fields.CharField(max_length=200)
    author = fields.ForeignKeyField(&quot;models.User&quot;, related_name=&quot;books&quot;)

# Admin 配置
@register(UserSerializer)
class UserAdmin(ModelAdmin):
    route_label = &quot;用户管理&quot;

    # 配置内联关系
    inlines = [
        # 一对一关系：用户档案
        AdminRelation(
            target=&quot;ProfileAdmin&quot;,
            source_field=&quot;id&quot;,
            target_field=&quot;user_id&quot;,
            relation=&quot;o2o&quot;
        ),

        # 一对多关系：用户的书籍
        AdminRelation(
            target=&quot;BookAdmin&quot;,
            source_field=&quot;id&quot;, 
            target_field=&quot;author_id&quot;,
            relation=&quot;fk&quot;
        ),

        # 多对多关系：用户角色（通过中间表）
        AdminRelation(
            target=&quot;RoleAdmin&quot;,
            relation=&quot;m2m&quot;,
            through=AdminThrough(
                through=&quot;UserRoleAdmin&quot;,
                source_field=&quot;id&quot;,
                source_to_through_field=&quot;user_id&quot;,
                target_field=&quot;id&quot;,
                target_to_through_field=&quot;role_id&quot;
            )
        ),
    ]

@register(ProfileSerializer)
class ProfileAdmin(ModelInlineAdmin):
    &quot;&quot;&quot;内联管理器 - 用于在其他模型中嵌入管理&quot;&quot;&quot;
    pass

@register(RoleSerializer) 
class RoleAdmin(ModelInlineAdmin):
    pass

@register(UserRoleSerializer)
class UserRoleAdmin(ModelInlineAdmin):
    pass

@register(BookSerializer)
class BookAdmin(ModelInlineAdmin):
    pass
</code></pre>
<h2 id="_10">自定义操作按钮</h2>
<h3 id="action">Action 装饰器</h3>
<pre><code class="language-python">from unfazed.contrib.admin.registry import action
from unfazed.contrib.admin.registry.schema import ActionKwargs
from unfazed.http import HttpResponse, JsonResponse
import json

@register(OrderSerializer)
class OrderAdmin(ModelAdmin):

    @action(name=&quot;确认订单&quot;, confirm=True)
    async def confirm_order(self, ctx: ActionKwargs) -&gt; dict:
        &quot;&quot;&quot;确认选中的订单&quot;&quot;&quot;
        # ctx.search_condition 包含筛选条件
        # ctx.form_data 包含表单数据
        # ctx.input_data 包含输入数据
        # ctx.request 包含当前请求对象

        queryset = OrderSerializer.get_queryset(ctx.search_condition)
        orders = await queryset

        confirmed_count = 0
        for order in orders:
            if order.status == 'pending':
                order.status = 'confirmed'
                order.confirmed_at = datetime.now()
                await order.save()
                confirmed_count += 1

        return {
            &quot;success&quot;: True,
            &quot;message&quot;: f&quot;成功确认 {confirmed_count} 个订单&quot;,
            &quot;confirmed_count&quot;: confirmed_count
        }

    @action(name=&quot;生成报表&quot;)
    async def generate_report(self, ctx: ActionKwargs) -&gt; HttpResponse:
        &quot;&quot;&quot;生成订单报表&quot;&quot;&quot;
        # 生成 Excel 报表
        import openpyxl
        from io import BytesIO

        wb = openpyxl.Workbook()
        ws = wb.active
        ws.title = &quot;订单报表&quot;

        # 表头
        headers = ['订单ID', '客户', '金额', '状态', '创建时间']
        for col, header in enumerate(headers, 1):
            ws.cell(row=1, column=col, value=header)

        # 数据
        queryset = OrderSerializer.get_queryset(ctx.search_condition)
        orders = await OrderSerializer.list_from_ctx(queryset)

        for row, order in enumerate(orders.data, 2):
            ws.cell(row=row, column=1, value=order['id'])
            ws.cell(row=row, column=2, value=order['customer']['name'])
            ws.cell(row=row, column=3, value=order['total_amount'])
            ws.cell(row=row, column=4, value=order['status'])
            ws.cell(row=row, column=5, value=order['created_at'])

        # 保存到内存
        buffer = BytesIO()
        wb.save(buffer)
        buffer.seek(0)

        return HttpResponse(
            buffer.getvalue(),
            headers={
                'Content-Type': 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
                'Content-Disposition': 'attachment; filename=&quot;order_report.xlsx&quot;'
            }
        )

    @action(name=&quot;发送通知&quot;, confirm=False)
    async def send_notification(self, ctx: ActionKwargs) -&gt; JsonResponse:
        &quot;&quot;&quot;发送通知到选中的客户&quot;&quot;&quot;
        message = ctx.form_data.get('message', '')
        if not message:
            return JsonResponse({
                &quot;success&quot;: False,
                &quot;error&quot;: &quot;请输入通知消息&quot;
            }, status_code=400)

        queryset = OrderSerializer.get_queryset(ctx.search_condition)
        orders = await queryset

        # 获取唯一客户列表
        customers = set()
        for order in orders:
            customers.add(order.customer_id)

        # 发送通知（示例）
        sent_count = 0
        for customer_id in customers:
            # 这里集成实际的通知服务
            # await notification_service.send(customer_id, message)
            sent_count += 1

        return JsonResponse({
            &quot;success&quot;: True,
            &quot;message&quot;: f&quot;成功发送通知给 {sent_count} 位客户&quot;,
            &quot;sent_count&quot;: sent_count
        })
</code></pre>
<h2 id="_11">权限管理系统</h2>
<h3 id="_12">基础权限控制</h3>
<pre><code class="language-python">from unfazed.contrib.admin.registry import ModelAdmin
from unfazed.http import HttpRequest

class SecureAdmin(ModelAdmin):
    &quot;&quot;&quot;安全的 Admin 基类&quot;&quot;&quot;

    async def has_view_perm(self, request: HttpRequest) -&gt; bool:
        &quot;&quot;&quot;查看权限 - 需要登录&quot;&quot;&quot;
        return request.user.is_authenticated

    async def has_create_perm(self, request: HttpRequest) -&gt; bool:
        &quot;&quot;&quot;创建权限 - 需要员工权限&quot;&quot;&quot;
        return request.user.is_superuser

    async def has_change_perm(self, request: HttpRequest) -&gt; bool:
        &quot;&quot;&quot;修改权限 - 需要员工权限&quot;&quot;&quot;
        return request.user.is_superuser

    async def has_delete_perm(self, request: HttpRequest) -&gt; bool:
        &quot;&quot;&quot;删除权限 - 需要超级用户权限&quot;&quot;&quot;
        return request.user.is_superuser

    async def has_action_perm(self, request: HttpRequest) -&gt; bool:
        &quot;&quot;&quot;操作权限 - 需要员工权限&quot;&quot;&quot;
        return request.user.is_superuser

@register(ProductSerializer)
class ProductAdmin(SecureAdmin):
    route_label = &quot;产品管理&quot;

    # 可以进一步细化权限
    async def has_delete_perm(self, request: HttpRequest) -&gt; bool:
        &quot;&quot;&quot;产品删除需要特殊权限&quot;&quot;&quot;
        # 只有产品管理员或超级用户可以删除产品
        return (
            request.user.is_superuser or 
            await request.user.roles.filter(name=&quot;产品管理员&quot;).exists()
        )
</code></pre>
<h3 id="_13">基于角色的权限控制</h3>
<pre><code class="language-python">class RoleBasedAdmin(ModelAdmin):
    &quot;&quot;&quot;基于角色的权限控制&quot;&quot;&quot;

    # 定义需要的角色
    view_roles = [&quot;员工&quot;, &quot;管理员&quot;, &quot;超级管理员&quot;]
    create_roles = [&quot;管理员&quot;, &quot;超级管理员&quot;]
    change_roles = [&quot;管理员&quot;, &quot;超级管理员&quot;]
    delete_roles = [&quot;超级管理员&quot;]
    action_roles = [&quot;管理员&quot;, &quot;超级管理员&quot;]

    async def _has_role(self, request: HttpRequest, required_roles: list) -&gt; bool:
        &quot;&quot;&quot;检查用户是否具有所需角色&quot;&quot;&quot;
        if not request.user.is_authenticated:
            return False

        if request.user.is_superuser:
            return True

        user_roles = await request.user.roles.all().values_list(&quot;name&quot;, flat=True)
        return any(role in user_roles for role in required_roles)

    async def has_view_perm(self, request: HttpRequest) -&gt; bool:
        return await self._has_role(request, self.view_roles)

    async def has_create_perm(self, request: HttpRequest) -&gt; bool:
        return await self._has_role(request, self.create_roles)

    async def has_change_perm(self, request: HttpRequest) -&gt; bool:
        return await self._has_role(request, self.change_roles)

    async def has_delete_perm(self, request: HttpRequest) -&gt; bool:
        return await self._has_role(request, self.delete_roles)

    async def has_action_perm(self, request: HttpRequest) -&gt; bool:
        return await self._has_role(request, self.action_roles)

@register(OrderSerializer)
class OrderAdmin(RoleBasedAdmin):
    route_label = &quot;订单管理&quot;

    # 订单管理需要特殊权限
    view_roles = [&quot;销售员&quot;, &quot;订单管理员&quot;, &quot;财务&quot;, &quot;管理员&quot;]
    create_roles = [&quot;销售员&quot;, &quot;订单管理员&quot;, &quot;管理员&quot;]
    change_roles = [&quot;订单管理员&quot;, &quot;管理员&quot;]
    delete_roles = [&quot;管理员&quot;]  # 只有管理员可以删除订单
</code></pre>
<h2 id="_14">操作日志系统</h2>
<h3 id="logentry">LogEntry 模型</h3>
<p>Admin 系统自动记录所有管理操作的日志：</p>
<pre><code class="language-python"># unfazed/contrib/admin/models.py
class LogEntry(Model):
    id = fields.IntField(primary_key=True)
    created_at = fields.BigIntField()  # 时间戳
    account = fields.CharField(max_length=255)  # 操作用户
    path = fields.CharField(max_length=255)  # 请求路径
    ip = fields.CharField(max_length=128)  # 客户端IP
    request = fields.TextField()  # 请求数据
    response = fields.TextField()  # 响应数据

    class Meta:
        table = &quot;unfazed_admin_logentry&quot;
        indexes = (&quot;account&quot;,)
</code></pre>
<h3 id="_15">日志装饰器</h3>
<pre><code class="language-python"># 自动记录日志的装饰器
from unfazed.contrib.admin.decorators import record

@login_required
@record  # 自动记录操作日志
async def model_save(request, ctx):
    # 保存操作会被自动记录
    pass

@login_required
@record  # 自动记录操作日志
async def model_delete(request, ctx):
    # 删除操作会被自动记录
    pass
</code></pre>
<h3 id="_16">查看操作日志</h3>
<pre><code class="language-python">@register(LogEntrySerializer)
class LogEntryAdmin(ModelAdmin):
    route_label = &quot;操作日志&quot;
    help_text = &quot;查看系统操作记录&quot;
    icon = &quot;history&quot;

    # 日志只允许查看，不允许修改
    async def has_create_perm(self, request) -&gt; bool:
        return False

    async def has_change_perm(self, request) -&gt; bool:
        return False

    async def has_delete_perm(self, request) -&gt; bool:
        return request.user.is_superuser  # 只有超级用户可以删除日志

    # 自定义操作：清理旧日志
    @action(name=&quot;清理30天前日志&quot;, confirm=True)
    async def cleanup_old_logs(self, ctx: ActionKwargs) -&gt; dict:
        &quot;&quot;&quot;清理30天前的日志&quot;&quot;&quot;
        thirty_days_ago = int(time.time()) - (30 * 24 * 60 * 60)
        deleted_count = await LogEntry.filter(
            created_at__lt=thirty_days_ago
        ).count()

        await LogEntry.filter(created_at__lt=thirty_days_ago).delete()

        return {
            &quot;success&quot;: True,
            &quot;message&quot;: f&quot;成功清理 {deleted_count} 条旧日志记录&quot;
        }
</code></pre>
<h2 id="api">API 接口详解</h2>
<h3 id="api_1">核心 API 端点</h3>
<p>Admin 系统提供以下 RESTful API 端点：</p>
<pre><code class="language-python"># 路由列表 - 获取可访问的管理模块
GET /api/contrib/admin/route-list
# 响应: { &quot;data&quot;: [AdminRoute] }

# 站点设置 - 获取管理站点配置
GET /api/contrib/admin/settings  
# 响应: { &quot;data&quot;: AdminSite }

# 模型描述 - 获取模型字段定义
POST /api/contrib/admin/model-desc
# 请求: { &quot;name&quot;: &quot;UserAdmin&quot; }
# 响应: { &quot;data&quot;: AdminSerializeModel }

# 内联关系 - 获取模型关系字段
POST /api/contrib/admin/model-inlines
# 请求: { &quot;name&quot;: &quot;UserAdmin&quot;, &quot;data&quot;: {} }
# 响应: { &quot;data&quot;: { &quot;ProfileAdmin&quot;: AdminInlineSerializeModel } }

# 模型数据 - 分页查询模型数据
POST /api/contrib/admin/model-data
# 请求: { &quot;name&quot;: &quot;UserAdmin&quot;, &quot;cond&quot;: [], &quot;page&quot;: 1, &quot;size&quot;: 20 }
# 响应: { &quot;data&quot;: { &quot;data&quot;: [], &quot;total&quot;: 0, &quot;page&quot;: 1, &quot;size&quot;: 20 } }

# 模型保存 - 创建或更新模型
POST /api/contrib/admin/model-save
# 请求: { &quot;name&quot;: &quot;UserAdmin&quot;, &quot;data&quot;: { &quot;id&quot;: 0, &quot;name&quot;: &quot;新用户&quot; } }
# 响应: { &quot;data&quot;: {...} }

# 模型删除 - 删除模型记录
POST /api/contrib/admin/model-delete
# 请求: { &quot;name&quot;: &quot;UserAdmin&quot;, &quot;data&quot;: { &quot;id&quot;: 1 } }
# 响应: { &quot;data&quot;: {} }

# 模型操作 - 执行自定义操作
POST /api/contrib/admin/model-action
# 请求: { &quot;name&quot;: &quot;UserAdmin&quot;, &quot;action&quot;: &quot;export_csv&quot;, &quot;search_condition&quot;: [], &quot;form_data&quot;: {}, &quot;input_data&quot;: {} }
# 响应: 取决于操作实现
</code></pre>
<h3 id="_17">查询条件格式</h3>
<pre><code class="language-python"># 条件查询格式
conditions = [
    {&quot;field&quot;: &quot;name&quot;, &quot;eq&quot;: &quot;张三&quot;},           # 等于
    {&quot;field&quot;: &quot;age&quot;, &quot;gt&quot;: 18},               # 大于
    {&quot;field&quot;: &quot;age&quot;, &quot;gte&quot;: 18},              # 大于等于
    {&quot;field&quot;: &quot;age&quot;, &quot;lt&quot;: 60},               # 小于
    {&quot;field&quot;: &quot;age&quot;, &quot;lte&quot;: 60},              # 小于等于
    {&quot;field&quot;: &quot;status&quot;, &quot;in&quot;: [&quot;active&quot;, &quot;pending&quot;]},  # 包含
    {&quot;field&quot;: &quot;email&quot;, &quot;like&quot;: &quot;%@gmail.com&quot;},  # 模糊匹配
    {&quot;field&quot;: &quot;deleted_at&quot;, &quot;is_null&quot;: True},    # 空值
]
</code></pre>
<h2 id="_18">总结</h2>
<p>Unfazed Admin 为现代异步 Web 应用提供了完整的后台管理解决方案：</p>
<p><strong>核心优势</strong>：
- 🚀 <strong>异步优化</strong>: 基于 asyncio 的高性能异步操作
- 🎯 <strong>易于使用</strong>: 类似 Django Admin 的简洁 API
- 🔧 <strong>功能完整</strong>: CRUD、权限、日志、关系管理等全功能支持
- 📊 <strong>灵活扩展</strong>: 自定义操作、字段、权限控制
- 🛡️ <strong>安全可靠</strong>: 完整的权限系统和操作审计</p>
<p><strong>关键特性</strong>：
- 自动化的模型管理界面生成
- 基于角色的细粒度权限控制
- 支持复杂关系字段的内联编辑
- 自定义业务操作和批量操作
- 完整的操作日志和审计追踪
- 高度可定制的字段和表单</p>
<p>通过 Unfazed Admin，开发者可以快速构建功能强大、安全可靠的管理后台，专注于业务逻辑的实现，而无需从零开始构建管理界面。</p>
<p><strong>技术亮点</strong>：
- 📈 <strong>高性能</strong>: 异步数据库操作和查询优化
- 🎨 <strong>设计优雅</strong>: 清晰的架构和简洁的 API
- 🔄 <strong>灵活配置</strong>: 支持各种定制需求
- 🏆 <strong>生产就绪</strong>: 完整的安全机制和错误处理</p>
<p>无论是简单的内容管理还是复杂的企业级管理系统，Unfazed Admin 都能提供稳定、高效的解决方案。</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "\u5df2\u62f7\u8c9d", "clipboard.copy": "\u62f7\u8c9d", "search.result.more.one": "\u6b64\u9801\u5c1a\u6709 1 \u500b\u7b26\u5408\u7684\u9805\u76ee", "search.result.more.other": "\u6b64\u9801\u5c1a\u6709 # \u500b\u7b26\u5408\u7684\u9805\u76ee", "search.result.none": "\u6c92\u6709\u627e\u5230\u7b26\u5408\u689d\u4ef6\u7684\u7d50\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u689d\u4ef6\u7684\u7d50\u679c", "search.result.other": "\u627e\u5230 # \u500b\u7b26\u5408\u689d\u4ef6\u7684\u7d50\u679c", "search.result.placeholder": "\u9375\u5165\u4ee5\u958b\u59cb\u6aa2\u7d22", "search.result.term.missing": "\u7f3a\u5931", "select.version": "\u9078\u64c7\u7248\u672c"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.88dd0f4e.min.js"></script>
      
    
  </body>
</html>